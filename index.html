<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dengue Memory Quest</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- Import Map para Google GenAI e React (para evitar erros de importa√ß√£o do ambiente) -->
    <script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.39.0",
    "react": "https://esm.sh/react@^19.2.4",
    "react-dom/client": "https://esm.sh/react-dom@^19.2.4/client",
    "react/jsx-runtime": "https://esm.sh/react@^19.2.4/jsx-runtime",
    "react/": "https://esm.sh/react@^19.2.4/",
    "react-dom/": "https://esm.sh/react-dom@^19.2.4/"
  }
}
</script>

    <style>
      body {
        font-family: 'Fredoka', sans-serif;
        background-color: #f0fdf4; /* green-50 */
        user-select: none;
      }
      
      /* Utilit√°rios 3D para o efeito de virar a carta */
      .perspective-1000 {
        perspective: 1000px;
      }
      .transform-style-3d {
        transform-style: preserve-3d;
      }
      .backface-hidden {
        backface-visibility: hidden;
      }
      .rotate-y-180 {
        transform: rotateY(180deg);
      }
      .card-inner {
        transition: transform 0.5s;
      }
      
      /* Padr√£o de fundo das cartas */
      .pattern-bg {
        background-image: radial-gradient(#ff0000 1px, transparent 1px);
        background-size: 10px 10px;
      }

      /* Anima√ß√µes */
      @keyframes scaleIn {
        from { transform: scale(0.9); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
      }
      .animate-scale-in {
        animation: scaleIn 0.3s ease-out forwards;
      }
    </style>
</head>
<body class="min-h-screen flex flex-col text-gray-800">

    <!-- Header -->
    <header class="bg-gradient-to-r from-green-600 to-teal-600 text-white p-4 shadow-lg sticky top-0 z-40">
        <div class="container mx-auto flex justify-between items-center max-w-4xl">
            <div class="flex items-center space-x-2">
                <span class="text-3xl">üö´ü¶ü</span>
                <h1 class="text-xl sm:text-2xl font-bold hidden sm:block">Dengue Memory Quest</h1>
            </div>
            
            <div id="game-stats" class="hidden flex space-x-6 text-sm sm:text-base font-semibold">
                <div class="bg-white/20 px-3 py-1 rounded-full backdrop-blur-sm">
                    Jogadas: <span id="moves-count">0</span>
                </div>
                <div class="bg-yellow-400 text-yellow-900 px-3 py-1 rounded-full shadow-sm">
                    Pontos: <span id="score-count">0</span>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8 max-w-4xl flex-grow relative">
        
        <!-- Tela de Menu -->
        <div id="menu-screen" class="flex flex-col items-center justify-center min-h-[60vh] text-center animate-scale-in">
            <img src="https://i.imgur.com/GkRyMZD.png" 
                 alt="Agentes de Combate" 
                 class="w-48 h-48 mb-6 object-contain drop-shadow-xl animate-pulse" />
            <h2 class="text-4xl md:text-5xl font-bold text-green-800 mb-4">Combata o Mosquito!</h2>
            <p class="text-lg md:text-xl text-green-700 mb-8 max-w-lg">
                Encontre os pares de cartas correspondentes!
                Responda perguntas corretamente para eliminar o mosquito!
            </p>
            <button id="btn-start" class="bg-green-600 hover:bg-green-700 text-white text-2xl font-bold py-4 px-12 rounded-full shadow-xl transition-transform hover:scale-105 active:scale-95 ring-4 ring-green-300 cursor-pointer">
                Come√ßar Jogo
            </button>
        </div>

        <!-- Grid do Jogo -->
        <div id="game-screen" class="hidden">
            <div id="game-grid" class="grid grid-cols-3 sm:grid-cols-4 gap-3 sm:gap-6 mt-4">
                <!-- Cartas ser√£o geradas aqui via JS -->
            </div>
        </div>

        <!-- Tela de Game Over -->
        <div id="game-over-screen" class="hidden fixed inset-0 bg-green-900/90 z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-3xl p-8 max-w-md w-full text-center shadow-2xl border-8 border-green-400 animate-scale-in">
                <span class="text-6xl mb-4 block">üèÜ</span>
                <h2 class="text-3xl font-bold text-green-800 mb-2">Parab√©ns!</h2>
                <p class="text-gray-600 mb-6 text-lg">Voc√™ eliminou todos os focos da Dengue!</p>
                
                <div class="bg-green-100 rounded-xl p-4 mb-8">
                    <p class="text-2xl font-bold text-green-800"><span id="final-score">0</span> Pontos</p>
                    <p class="text-sm text-green-600">em <span id="final-moves">0</span> jogadas</p>
                </div>

                <button id="btn-restart" class="w-full bg-green-600 hover:bg-green-700 text-white text-xl font-bold py-4 rounded-xl shadow-lg transition-transform hover:scale-105">
                    Jogar Novamente
                </button>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loading-overlay" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center backdrop-blur-sm">
            <div class="bg-white p-6 rounded-xl flex flex-col items-center shadow-2xl">
                <div class="animate-spin rounded-full h-12 w-12 border-b-4 border-green-600 mb-4"></div>
                <p class="text-lg font-bold text-gray-700">O Mosquito est√° tentando fugir...</p>
                <p class="text-sm text-gray-500">Preparando pergunta...</p>
            </div>
        </div>

        <!-- Quiz Modal -->
        <div id="quiz-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4">
            <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full overflow-hidden animate-scale-in relative">
                <!-- Header Modal -->
                <div class="bg-yellow-400 p-6 flex flex-col items-center">
                    <span class="text-5xl mb-2">ü¶ü</span>
                    <h2 class="text-2xl font-bold text-yellow-900 text-center">Desafio da Dengue!</h2>
                    <p class="text-yellow-800 text-sm font-semibold mt-1">Responda corretamente para garantir o par!</p>
                </div>
                <!-- Content Modal -->
                <div class="p-8">
                    <p id="quiz-question-text" class="text-xl text-gray-800 font-medium text-center mb-8 leading-relaxed">
                        Carregando pergunta...
                    </p>

                    <div id="quiz-buttons" class="grid grid-cols-2 gap-4">
                        <button id="btn-true" class="py-4 rounded-xl bg-green-500 hover:bg-green-600 text-white font-bold text-xl transition-all active:scale-95 shadow-lg border-b-4 border-green-700">
                            VERDADEIRO
                        </button>
                        <button id="btn-false" class="py-4 rounded-xl bg-red-500 hover:bg-red-600 text-white font-bold text-xl transition-all active:scale-95 shadow-lg border-b-4 border-red-700">
                            FALSO
                        </button>
                    </div>

                    <div id="quiz-feedback" class="hidden text-center p-4 rounded-xl border-2">
                        <h3 id="feedback-title" class="text-2xl font-bold mb-2"></h3>
                        <p id="feedback-text" class="text-md leading-relaxed"></p>
                    </div>
                </div>
            </div>
        </div>

    </main>
    
    <footer class="py-6 text-center text-green-700/60 text-sm">
        <p>Desenvolvido para conscientiza√ß√£o sobre a Dengue.</p>
        <p>Direitos reservados a UNIRIO.</p>
    </footer>

    <!-- Elemento ROOT Oculto para satisfazer o index.tsx e corrigir o erro -->
    <div id="root" style="display: none;"></div>

    <!-- L√≥gica do Jogo -->
    <script type="module">
        import { GoogleGenAI, Type } from "@google/genai";

        // --- CONSTANTS ---
        const CARD_BACK_IMAGE = "https://imgur.com/53b9a0c5-96c5-465b-a8a3-fd53869ded17";

        const CARD_IMAGES = [
            { pairId: 1, name: "Aedes Aegypti", imageUrl: "https://agencia.ufc.br/wp-content/uploads/2017/05/170508_aedes_dstq.jpg" },
            { pairId: 2, name: "Pneu Velho", imageUrl: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQrhgReb6O13l2m4j9fXIxv9mpIZeb9dgx_0Q&s" },
            { pairId: 3, name: "√Ågua Parada", imageUrl: "https://f.i.uol.com.br/fotografia/2024/03/08/170993478065eb88bc08df7_1709934780_3x2_md.jpg" },
            { pairId: 4, name: "Vaso de Planta", imageUrl: "https://central.to.gov.br/image/10920?w=600&h=370" },
            { pairId: 5, name: "Sintoma: Febre", imageUrl: "https://media.einstein.br/sites/default/files/styles/card_mobile/public/2025-05/pessoa-sintomas-febre-afere-temperatura-com-termometro.jpg.webp?itok=yk5Mdrge" },
            { pairId: 6, name: "Repelente", imageUrl: "https://admin.cnnbrasil.com.br/wp-content/uploads/sites/12/2024/02/repelente-dengue.jpg?w=1200&h=900&crop=1" }
        ];

        const FALLBACK_QUESTIONS = [
            { text: "Ovos do Aedes aegypti morrem imediatamente se o local secar.", isTrue: false, explanation: "Falso! Os ovos podem resistir por mais de um ano no seco, esperando a √°gua voltar." },
            { text: "Do ovo at√© virar mosquito adulto leva apenas 7 a 10 dias no calor.", isTrue: true, explanation: "Verdadeiro! O ciclo √© muito r√°pido, por isso precisamos verificar a casa toda semana." },
            { text: "A larva do mosquito consegue viver fora da √°gua, na terra √∫mida.", isTrue: false, explanation: "Falso! A larva √© aqu√°tica. Se jogarmos a √°gua na terra seca ou no cimento quente, ela morre." },
            { text: "O mosquito da dengue costuma picar mais durante a noite e madrugada.", isTrue: false, explanation: "Falso! Ele tem h√°bitos diurnos: pica principalmente no in√≠cio da manh√£ e final da tarde." },
            { text: "Apenas a f√™mea do mosquito pica, pois precisa de sangue para os ovos.", isTrue: true, explanation: "Verdadeiro! O macho se alimenta apenas de n√©ctar e sucos de plantas." },
            { text: "Colocar areia nos pratinhos de plantas ajuda a combater a dengue.", isTrue: true, explanation: "Verdadeiro! A areia elimina a √°gua parada onde o mosquito colocaria os ovos." },
            { text: "Dor forte atr√°s dos olhos √© um sintoma muito comum da dengue.", isTrue: true, explanation: "Verdadeiro! Essa dor (retro-orbital) √© uma das caracter√≠sticas que diferencia da gripe." },
            { text: "Manchas vermelhas na pele podem aparecer em quem tem dengue.", isTrue: true, explanation: "Verdadeiro! Chamamos isso de exantema, e pode vir acompanhado de coceira." }
        ];

        const QUIZ_TOPICS = [
            "Ovo do mosquito: resist√™ncia √† seca", "Fase de Larva: vive na √°gua e se alimenta de sujeira", 
            "Tempo do ciclo: ovo vira adulto em 7 a 10 dias", "Tempo de vida do mosquito adulto (30 a 45 dias)", 
            "H√°bito de picada: prefere o dia", "Apenas a f√™mea pica", "O macho do Aedes se alimenta de n√©ctar", 
            "Dengue n√£o passa pelo contato ou beijo", "Voo baixo: o mosquito costuma voar baixo", 
            "Dor atr√°s dos olhos", "Manchas vermelhas no corpo (exantema)", "Diferen√ßa da gripe: dengue n√£o tem coriza", 
            "Ovos nas paredes dos recipientes", "Calhas entupidas e lajes", "Ralos pouco usados: precisam de tela", 
            "Bebedouros de animais: lavar com bucha"
        ];

        // --- STATE ---
        let cards = [];
        let flippedCards = [];
        let moves = 0;
        let score = 0;
        let isProcessing = false;
        let currentQuestion = null;
        
        // Bags para controle de n√£o repeti√ß√£o
        let availableTopics = [];
        let availableFallbackQuestions = [];

        // --- DOM ELEMENTS ---
        const menuScreen = document.getElementById('menu-screen');
        const gameScreen = document.getElementById('game-screen');
        const gameOverScreen = document.getElementById('game-over-screen');
        const gameGrid = document.getElementById('game-grid');
        const gameStats = document.getElementById('game-stats');
        const movesEl = document.getElementById('moves-count');
        const scoreEl = document.getElementById('score-count');
        const finalScoreEl = document.getElementById('final-score');
        const finalMovesEl = document.getElementById('final-moves');
        const loadingOverlay = document.getElementById('loading-overlay');
        const quizModal = document.getElementById('quiz-modal');
        const quizText = document.getElementById('quiz-question-text');
        const quizButtons = document.getElementById('quiz-buttons');
        const quizFeedback = document.getElementById('quiz-feedback');
        const feedbackTitle = document.getElementById('feedback-title');
        const feedbackText = document.getElementById('feedback-text');

        // --- GEMINI SERVICE ---
        async function generateDengueQuestion() {
            // Tenta obter a API key do ambiente global
            const apiKey = (typeof process !== 'undefined' && process.env) ? process.env.API_KEY : null;

            if (!apiKey) {
                console.warn("API Key not found. Using fallback questions.");
                return null;
            }

            try {
                const ai = new GoogleGenAI({ apiKey });

                // L√≥gica de n√£o repeti√ß√£o de t√≥picos (Reshuffle se vazio)
                if (availableTopics.length === 0) {
                    availableTopics = [...QUIZ_TOPICS];
                }
                
                // Escolhe um √≠ndice aleat√≥rio e remove do array (Splice)
                const topicIndex = Math.floor(Math.random() * availableTopics.length);
                const randomTopic = availableTopics[topicIndex];
                availableTopics.splice(topicIndex, 1);

                const response = await ai.models.generateContent({
                    model: "gemini-3-flash-preview",
                    contents: `
                        Voc√™ √© um professor de ci√™ncias criando um jogo para alunos do 6¬∫ ano (11 a 12 anos).
                        Baseado no 'Manual de Manejo Cl√≠nico da Dengue (Minist√©rio da Sa√∫de)', gere uma pergunta de VERDADEIRO ou FALSO.
                        Foco espec√≠fico da pergunta: ${randomTopic}.
                        Regras:
                        1. A pergunta DEVE ser apenas sobre: Ciclo de vida, Sintomas, Transmiss√£o ou Prolifera√ß√£o/Preven√ß√£o.
                        2. N√ÉO pergunte sobre medicamentos (AAS, Dipirona), tratamento hospitalar ou outras doen√ßas.
                        3. Use linguagem curiosa e desafiadora para crian√ßas de 11 anos.
                        4. A 'explanation' deve explicar o fato cient√≠fico de forma simples.
                        Retorne JSON com: text (string), isTrue (boolean), explanation (string).
                    `,
                    config: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: Type.OBJECT,
                            properties: {
                                text: { type: Type.STRING },
                                isTrue: { type: Type.BOOLEAN },
                                explanation: { type: Type.STRING },
                            },
                            required: ["text", "isTrue", "explanation"],
                        },
                    },
                });

                if (response.text) {
                    return JSON.parse(response.text);
                }
                return null;
            } catch (error) {
                console.error("Gemini API Error:", error);
                return null;
            }
        }

        // --- GAME LOGIC ---

        // Fun√ß√£o global para ser chamada pelo onclick do HTML gerado
        window.handleCardClick = (id) => {
             if (isProcessing) return;

            const cardIndex = cards.findIndex(c => c.uniqueId === id);
            if (cardIndex === -1) return;
            const card = cards[cardIndex];

            // Ignore if already flipped or already matched
            if (card.isFlipped || card.isMatched) return;

            // Flip logic
            card.isFlipped = true;
            document.getElementById(`inner-${id}`).classList.add('rotate-y-180');
            flippedCards.push(card);

            if (flippedCards.length === 2) {
                moves++;
                updateStats();
                isProcessing = true;
                checkForMatch();
            }
        };

        function initGame() {
            document.getElementById('btn-start').addEventListener('click', startGame);
            document.getElementById('btn-restart').addEventListener('click', startGame);
            document.getElementById('btn-true').addEventListener('click', () => handleQuizAnswer(true));
            document.getElementById('btn-false').addEventListener('click', () => handleQuizAnswer(false));
        }

        function startGame() {
            // Reset State
            const pairs = [...CARD_IMAGES, ...CARD_IMAGES];
            cards = pairs
                .sort(() => Math.random() - 0.5)
                .map((item, index) => ({
                    ...item,
                    uniqueId: `card-${index}`,
                    isFlipped: false,
                    isMatched: false
                }));
            
            // Inicializa as "bags" com c√≥pias completas das listas
            availableTopics = [...QUIZ_TOPICS];
            availableFallbackQuestions = [...FALLBACK_QUESTIONS];

            flippedCards = [];
            moves = 0;
            score = 0;
            isProcessing = false;

            // Update UI
            updateStats();
            renderGrid();
            
            menuScreen.classList.add('hidden');
            gameOverScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            gameStats.classList.remove('hidden');
        }

        function updateStats() {
            movesEl.textContent = moves;
            scoreEl.textContent = score;
        }

        function renderGrid() {
            gameGrid.innerHTML = '';
            cards.forEach(card => {
                const cardEl = document.createElement('div');
                
                // Base classes
                let classes = "group relative w-full aspect-[3/4] perspective-1000 ";
                
                // Cursor logic based on isMatched
                if (card.isMatched) {
                    classes += "cursor-default";
                } else {
                    classes += "cursor-pointer";
                }

                cardEl.className = classes;
                // Usando window.handleCardClick para garantir escopo
                cardEl.setAttribute('onclick', `window.handleCardClick('${card.uniqueId}')`);
                
                // Rotation logic: Flipped OR Matched (both stay face up)
                const isFaceUp = card.isFlipped || card.isMatched;
                const rotationClass = isFaceUp ? 'rotate-y-180' : '';

                // HTML Structure of the card
                cardEl.innerHTML = `
                    <div id="inner-${card.uniqueId}" class="card-inner duration-500 transform-style-3d relative w-full h-full shadow-lg rounded-xl ${rotationClass}">
                        <!-- FRONT (Verso - Logotipo) -->
                        <div class="absolute w-full h-full backface-hidden bg-white border-4 border-red-500 rounded-xl flex items-center justify-center p-4 overflow-hidden">
                            <div class="absolute inset-0 bg-red-50 opacity-10 pattern-bg"></div>
                            <div class="flex flex-col items-center justify-center opacity-80 z-10">
                                <img src="${CARD_BACK_IMAGE}" alt="Verso" class="w-16 h-16 mb-2" />
                                <span class="text-red-600 font-bold text-sm text-center">Combata a Dengue</span>
                            </div>
                        </div>
                        <!-- BACK (Frente - Imagem do par) -->
                        <div class="absolute w-full h-full backface-hidden bg-white border-4 border-green-500 rounded-xl flex flex-col items-center justify-center p-2 rotate-y-180">
                            <img src="${card.imageUrl}" alt="${card.name}" class="w-full h-24 object-contain mb-2 rounded-md" />
                            <span class="text-green-800 font-bold text-xs sm:text-sm text-center leading-tight">
                                ${card.name}
                            </span>
                        </div>
                    </div>
                `;
                gameGrid.appendChild(cardEl);
            });
        }

        async function checkForMatch() {
            const [card1, card2] = flippedCards;
            const isMatch = card1.pairId === card2.pairId;

            if (isMatch) {
                // Match Found: Trigger Quiz
                loadingOverlay.classList.remove('hidden');
                
                let question = await generateDengueQuestion();
                if (!question) {
                    // Fallback Logic com n√£o repeti√ß√£o
                    if (availableFallbackQuestions.length === 0) {
                        availableFallbackQuestions = [...FALLBACK_QUESTIONS];
                    }
                    const idx = Math.floor(Math.random() * availableFallbackQuestions.length);
                    question = availableFallbackQuestions[idx];
                    availableFallbackQuestions.splice(idx, 1); // Remove usada
                }

                currentQuestion = question;
                loadingOverlay.classList.add('hidden');
                showQuizModal();
            } else {
                // No Match
                setTimeout(() => {
                    // Visual unflip
                    document.getElementById(`inner-${card1.uniqueId}`).classList.remove('rotate-y-180');
                    document.getElementById(`inner-${card2.uniqueId}`).classList.remove('rotate-y-180');
                    // Update State
                    card1.isFlipped = false;
                    card2.isFlipped = false;
                    flippedCards = [];
                    isProcessing = false;
                }, 1000);
            }
        }

        function showQuizModal() {
            quizText.textContent = currentQuestion.text;
            quizButtons.classList.remove('hidden');
            quizFeedback.classList.add('hidden');
            
            // Reset styles
            quizFeedback.className = "hidden text-center p-4 rounded-xl border-2";
            
            quizModal.classList.remove('hidden');
        }

        function handleQuizAnswer(userChoice) {
            const isCorrect = userChoice === currentQuestion.isTrue;
            
            // Show Feedback
            quizButtons.classList.add('hidden');
            quizFeedback.classList.remove('hidden');
            
            if (isCorrect) {
                quizFeedback.classList.add('bg-green-100', 'text-green-800', 'border-green-400');
                quizFeedback.classList.remove('bg-red-100', 'text-red-800', 'border-red-400');
                feedbackTitle.textContent = "Correto! üéâ";
            } else {
                quizFeedback.classList.add('bg-red-100', 'text-red-800', 'border-red-400');
                quizFeedback.classList.remove('bg-green-100', 'text-green-800', 'border-green-400');
                feedbackTitle.textContent = "Ops! Errado. üòì";
            }
            feedbackText.textContent = currentQuestion.explanation;

            // Resolve Match logic after delay to read feedback
            setTimeout(() => {
                quizModal.classList.add('hidden');
                resolveMatchAttempt(isCorrect);
            }, 4500); // 4.5s delay like in original App.tsx
        }

        function resolveMatchAttempt(isCorrect) {
            const [card1, card2] = flippedCards;

            if (isCorrect) {
                score += 10;
                // Mark as matched
                card1.isMatched = true;
                card2.isMatched = true;
                // Ensure they stay flipped visually (handled by re-render or class persistence)
                // We re-render here to update the 'cursor-default' class and ensure state consistency
                renderGrid();
            } else {
                // Wrong answer penalty: flip cards back
                // Visual unflip
                const el1 = document.getElementById(`inner-${card1.uniqueId}`);
                const el2 = document.getElementById(`inner-${card2.uniqueId}`);
                if (el1) el1.classList.remove('rotate-y-180');
                if (el2) el2.classList.remove('rotate-y-180');
                
                card1.isFlipped = false;
                card2.isFlipped = false;
            }

            flippedCards = [];
            isProcessing = false;
            updateStats();
            checkGameOver();
        }

        function checkGameOver() {
            if (cards.every(c => c.isMatched)) {
                finalScoreEl.textContent = score;
                finalMovesEl.textContent = moves;
                gameScreen.classList.add('hidden');
                gameStats.classList.add('hidden');
                gameOverScreen.classList.remove('hidden');
            }
        }

        // Init
        initGame();

    </script>
</body>
</html>
